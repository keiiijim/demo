<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<title>WipeAd Sample</title>
<style>
#titlearea{
border-top-left-radius: 5px;
border-top-right-radius: 5px;
border-bottom-right-radius: 5px;
border-bottom-left-radius: 5px;
margin:0 0 5px 0;
padding:0 0 0 10px;
background-color:#aaaaaa;
height:15px;
font-size:10px;
}
#closearea{
float:right;
color:#555555;
padding-right:10px;
}
#endcard{
position:absolute;
display:none;
width:100%;
height:100%;
background-color:rgba(0, 0, 0, 0.4);
text-align:center;
z-index:1;
}

#endcardbtn{
padding:20% 0 0 0;
}

</style>


</head>
<body style = "margin:0px; background-color:#ffffff;">
<h1>WipeAd Sample</h1>

<div>
Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership 
</div>

<div id="inlinearea" style="margin:10px 0 10px 0px;height:180px">
<div id="adimg">

<div id="endcard">
<div id="endcardbtn">
<img src="adg_video_button_replay.png" width="30%" height="30%" id="replay" />
<img src="adg_video_button_detail.png" width="30%" height="30%" />
</div>
</div>

<!-- <img src="https://placehold.jp/320x180.png" /> -->
<video src="sample.mp4" id="advideo" style="width:320px;height:180px;" muted></video>
</div>
</div>

<div>
Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership 
</div>

<div>
Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership 
</div>

<div>
Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership 
</div>

<div>
Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership Supership 
</div>


<div id="wipearea">
<div id="titlearea">Advertisement<span id="closearea">x</span></div>
<div id="wipeadarea">
</div>
</div>




<script>
var isClosed = false;
var isFinish = false;

const checkScroll = () => {
    var winScroll = window.scrollY;
    var inline = document.getElementById("inlinearea");
    var adImg = document.getElementById("adimg");
    var wipe = document.getElementById("wipearea");
    var adVideo = document.getElementById("advideo");
    var adWipe = document.getElementById("wipeadarea");
    var adTop = inline.getBoundingClientRect().top;
    
    inline.style.width = "320px"
    inline.style.height = "180px"
    wipe.style.width = "160px";
    wipe.style.height = "110px";
    adWipe.style.width = "160px";
    adWipe.style.height = "90px";

    if(adTop < -180 && !isClosed){
        wipe.style.display ="block";
        wipe.style.position = 'fixed';
        wipe.style.bottom = "20px";
        wipe.style.right = "20px";

        if(adImg.parentNode === inline){
            inline.removeChild(adImg)
            adWipe.appendChild(adImg)
            adVideo.style.width = "160px"
            adVideo.style.height = "90px"
        }
    } else{
        adImg.style.position = 'relative';
        wipe.style.display ="none";
        if(adImg.parentNode === adWipe){
            adWipe.removeChild(adImg);
            inline.appendChild(adImg);
            adVideo.style.width = "320px"
            adVideo.style.height = "180px"
        }
    }
}
setInterval(checkScroll, 100);

document.getElementById("closearea").addEventListener('click', function() {
    isClosed = true;
});

// inview判定
new IntersectionObserver(function (entries, observer) {
    if (entries[0].intersectionRatio >= 0.5 && isFinish == false){
        document.getElementById('advideo').play();
    } else {
        document.getElementById('advideo').pause();   
    }
},{threshold:[0.2 , 0.4 , 0.5 , 0.6 , 0.8]}).observe(document.getElementById("advideo"));

// swipe

var startX = 0;
document.getElementById("wipearea").addEventListener('mousedown', function(e) {
    startX = e.offsetX;
})
document.getElementById("wipearea").addEventListener('mouseup', function(e) {
    if (e.offsetX - startX > 100) {
        isClosed = true;
    }
})

// video finish
document.getElementById('advideo').addEventListener('ended', function() {
    isFinish = true;
    document.getElementById('endcard').style.display ="block";
});

// replay
document.getElementById('replay').addEventListener('click', function() {
    isFinish = false;
    document.getElementById('endcard').style.display ="none";
    document.getElementById('advideo').play();
});
</script>


</body>
</html>
